\lstdefinestyle{MethodenListe}{
    language   = Python,
    numbers    = none,
    belowskip  = 0.25em,
    basicstyle = \tt\small
}

%-------------------------------------------------------------------------------
\section{Einführung in das Semester}
%-------------------------------------------------------------------------------

%%% Folie
\begin{frame}{Kompetenzziele der Vorlesung}
    \begin{itemize}
        \item \textbf{Fachkompetenz:} Die Studierenden kennen den technischen Aufbau typischer
        Devices/Embedded Systems im Kontext der Internet of Things. Sie sind in der Lage,
        entsprechende Devices für einen gegebenen Einsatzzweck auszuwählen und zu programmieren.
        \medskip

        \item \textbf{Methodenkompetenz:} Die Studierenden sind in der Lage bei der Programmierung
        von IoT-Geräten systematisch und methodisch vorzugehen.
        \medskip

        \item \textbf{Personale und soziale Kompetenz:} Die Studierenden verstehen die Herausforderungen
        des IoT für Unternehmen, Politik und Gesellschaft und sind in der Lage, diese kompetent zu diskutieren.
        \medskip

        \item \textbf{Übergreifende Handlungskompetenz:} Die Studierenden können reale betriebliche
        Problemstellungen im Kontext von IoT analysieren, Konzepte entwerfen und IoT-fähige Geräte
        programmieren und im Unternehmenskontext integrieren.
        \medskip
    \end{itemize}
\end{frame}

{
\footnotesize
%%% Folie
\begin{frame}{Inhalte der Vorlesung}
        \begin{columns}
            \begin{column}[T]{.5\textwidth}
                \begin{block}{3. Semester}
                    \medskip
                    \textbf{Prüfungsform:} Klausur
                    \medskip

                    \begin{enumerate}
                        \item Grundlagen des Internet of Things
                        \item Hardwaredesign für IoT-Anwendungen
                        \item \textcolor{gray}{Übungsstunde}
                        \item \textcolor{gray}{Übungsstunde}
                        \item Einführung in Python
                        \item IoT-Entwicklung mit Python
                        \item \textcolor{gray}{Übungsstunde}
                        \item \textcolor{gray}{Übungsstunde}
                        \item \textcolor{gray}{Klausurvorbereitung}
                    \end{enumerate}
                \end{block}
            \end{column}
            \begin{column}[T]{.5\textwidth}
                \begin{block}{4. Semester}
                    \medskip
                    \textbf{Prüfungsform:} Assignment
                    \medskip

                    \begin{enumerate}
                        \item Nutzung analoger und digitaler Bauteile
                        \item Python-Architekturmuster für IoT-Devices
                        \item Datenaustausch und Systemintegration
                        \item Linux-Konfiguration und Deployment
                        \item \textcolor{gray}{Assignment}
                        \item \textcolor{gray}{Assignment}
                        \item \textcolor{gray}{Assignment}
                        \item \textcolor{gray}{Assignment}
                        \item \textcolor{gray}{Assignment}
                    \end{enumerate}
                \end{block}
            \end{column}
        \end{columns}
\end{frame}
}

%%% Folie
{
\setbeamertemplate{background canvas}{
    \includegraphics[height=\paperheight, width=\paperwidth]{1-grundlagen/img/themengebiete4}
}

\begin{frame}[plain]
\end{frame}
}

%%% Folie
\begin{frame}{Beispiel einer typischen IoT-Architektur}
    \begin{columns}
        \column{\dimexpr\paperwidth-10pt}
        \includegraphics[width=\textwidth]{1-grundlagen/img/architektur_beispiel}
    \end{columns}
\end{frame}

%%% Folie
{
\small

\begin{frame}{Inhalt der Assignment-Prüfung}
    \begin{columns}[onlytextwidth]
        \column[t]{.45\textwidth}
        \begin{block}{Kreativaufgabe}
            \medskip
            \parbox{\linewidth}{
                Ausarbeitung eines Hard- und Softwareentwurfs zu einem \textbf{selbst gewählten IoT-Anwendungsfall}.
                \medskip

                Muss die wesentlichen Theorieinhalte beider Semester abdecken.
                \medskip

                Jedoch keinen Quellcode, keine Details und keine praktische Umsetzung. Nur das Konzept.
            }
        \end{block}

        \column[t]{.45\textwidth}
        \begin{block}{Programmieraufgabe}
            \medskip
            \parbox{\linewidth}{
                Praktische Umsetzung eines \textbf{vorgegebenen IoT-Anwendungsfalls}.
                \medskip

                Muss gegen vorgegebene Schnittstellen zum Mocken der Hardwareelemente
                programmiert werden.
                \medskip

                Bewertet werden die Qualität des Quellcodes und die Erfüllung der von
                uns vorgegebenen Unit Tests.
            }
        \end{block}
    \end{columns}

    \bigskip
    \bigskip
    {
        \normalsize
        Die Aufgabenstellung wird bis zum Ende des Theorieblocks bereitgestellt.
    }
\end{frame}
}

%%% Folie
{
\small
\setlength{\fboxsep}{0pt}

\begin{frame}{Literaturempfehlungen}
    \begin{columns}
        \column[b]{.25\textwidth}
        \fbox{\includegraphics[height=3.8cm]{5-hardwarenutzung/img/buch_raspberrypi}}

        \column[b]{.25\textwidth}
        \fbox{\includegraphics[height=3.8cm]{5-hardwarenutzung/img/buch_mqtt_essentials}}

        \column[b]{.25\textwidth}
        \fbox{\includegraphics[height=3.8cm]{5-hardwarenutzung/img/buch_elektronik_dummies}}

        \column[b]{.25\textwidth}
        \fbox{\includegraphics[height=3.8cm]{5-hardwarenutzung/img/buch_elektronik_fibel}}
    \end{columns}

    \vskip 0.6cm

    \begin{columns}
        \column[T]{.5\textwidth}
        \textbf{Raspberry Pi: Das umfassende Handbuch für Maker und Tekkies} \\ Rheinwerk Verlag, 2018

        \column[T]{.5\textwidth}
        \textbf{MQTT Essentials: \\ A Lightweight IoT Protocol} \\ Packt>, 2017
    \end{columns}

    \vskip 0.6cm

    \begin{columns}
        \column[T]{.5\textwidth}
        \textbf{Elektronik für Dummies} \\ Wiley-VCH Verlag, 2018

        \column[T]{.5\textwidth}
        \textbf{Elektronik-Fibel} \\ Patrick Schnabel, 2017
    \end{columns}
\end{frame}
}

%-------------------------------------------------------------------------------
\section{Ziel der heutigen Vorlesung}
%-------------------------------------------------------------------------------

%%% Folie
{
\footnotesize
\setlength{\leftmargini}{1.2em}

\begin{frame}{Typischer Systemaufbau eingebetteter Systeme}
    \begin{columns}
        \column{\dimexpr\paperwidth}

        \only<beamer:1|handout:0>{
            \includegraphics[width=\paperwidth]{5-hardwarenutzung/img/mc_aufbau1}
        }

        \only<beamer:2|handout:1>{
            \transdissolve
            \includegraphics[width=\paperwidth]{5-hardwarenutzung/img/mc_aufbau2}
        }
    \end{columns}

    \medskip

    \begin{columns}
        \begin{column}[T]{.3\textwidth}
            \textbf{Raspberry Pi}
            \begin{itemize}
                \item Binäre Ein-/Ausgänge
                \item PWM-Ausgänge
                \item Serielle Ein-/Ausgänge
                \item<2> \textcolor{darkred}{Kein Analog I/O}
                \item<2> \textcolor{darkred}{Keine Bus Interface!}
            \end{itemize}
        \end{column}
        \begin{column}[T]{.3\textwidth}
            \textbf{Letztes Semester}
            \begin{itemize}
                \item Binäre Ein-/Ausgänge
                \item PWM-Ausgänge
                \item DHT11 via 1-Wire
                \item Programmierung in Python
            \end{itemize}
        \end{column}
        \begin{column}[T]{.3\textwidth}
            \textbf{Dieses Semester}
            \begin{itemize}
                \item Analog-Digital-Konverter
                \item Serielle Sensoren/Aktoren
                \item Serielle Kommunikation mit anderen µControllern
                \item Programmierung in Python
            \end{itemize}
        \end{column}
    \end{columns}
\end{frame}
}

%%% Folie
{
\scriptsize

\begin{frame}{Inhalt unseres Sensorkits}
    \begin{columns}[onlytextwidth]
        \column[T]{.3\textwidth}
        \textbf{Analoge Schnittstelle} \\
        KY-003: Hall Magnetfeldsensor \\
        KY-006: Passiver Piezo-Buzzer \\
        KY-009: RGB-LED \\
        KY-011: Rot/Grün-LED \\
        KY-012: Aktiver Piezo-Buzzer \\
        KY-013: Temperatursensor \\
        KY-016: RGB-LED \\
        KY-018: Fotowiderstand \\
        KY-023: XY-Joystick \\
        KY-024: Magnetic Hall-Sensor \\
        KY-025: Reedkontakt \\
        KY-026: Flammensensor \\
        KY-028: Thermistor \\
        KY-029: Rot/Grün-LED \\
        KY-034: 7-Farben LED \\
        KY-035: Bihor Magnetsensor \\
        KY-036: Metall-Touchsensor \\
        KY-037: Mikrofon Soundsensor \\
        KY-038: Mikrofon Soundsensor \\
        KY-039: Herzschlagsensor \\
        KY-040: Kodierter Drehschalter \\
        KY-050: Ultraschallabstand \\

        \column[T]{.3\textwidth}
        \textbf{Binäre An/Aus-Schnittstelle} \\
        KY-002: Erschütterungsschalter \\
        KY-003: Hall Magnetfeldsensor \\
        KY-004: Taster \\
        KY-010: Lichtschranke \\
        KY-012: Aktiver Piezo-Buzzer \\
        KY-017: Neigungsschalter \\
        KY-019: 5V Relais \\
        KY-020: Neigungsschalter \\
        KY-021: Mini Magnet-Reedkontakt \\
        KY-024: Magnetic Hall-Sensor \\
        KY-025: Reedkontakt \\
        KY-026: Flammensensor \\
        KY-027: Magic Light Cup \\
        KY-028: Thermistor \\
        KY-031: Klopfsensor \\
        KY-032: Hindernisdetektor \\
        KY-033: Trackingsensor \\
        KY-036: Metall-Touchsensor \\
        KY-037: Mikrofon Soundsensor \\
        KY-038: Mikrofon Soundsensor \\

        \column[T]{.3\textwidth}
        \textbf{Serielle Schnittstelle} \\
        KY-001: DS18B20 Temperatur \\
        KY-015: DHT11 Temp./Feuchtig. \\
        KY-052: BMP280 Druck \\
        KY-053: Analog/Digital Konverter \\
    \end{columns}

    \bigskip
    {
        \footnotesize
        Online-Dokumentation: \\
        \url{http://sensorkit.joy-it.net/index.php?title=Hauptseite}
    }
\end{frame}
}

%%% Folie
\begin{frame}{Lernziele}
    \begin{block}{Wiederholung}
        \begin{itemize}
            \item Breadboards zum Aufbau einfacher Schaltungen nutzen können
            \item Binäre Bauteile via GPIO mit dem Pi verbinden können
            \item Via GPIO angebundene Bauteile in Python nutzen können
        \end{itemize}
    \end{block}

    \begin{block}{Neue Inhalte}
        \begin{itemize}
            \item Funktionsweise serieller Schnittstellen erklären können
            \item Synchrone und asynchrone, serielle Schnittstellen abgrenzen können
            \item Digitale Bauteile via SPI, I²C mit dem Pi verbinden können
            \item Analoge Bauteile via A/D-Konverter mit dem Pi verbinden können
            \item Seriell angebundene Bauteile in Python nutzen können
        \end{itemize}
    \end{block}
\end{frame}

%-------------------------------------------------------------------------------
\section{Nutzung binärer Bauteile}
%-------------------------------------------------------------------------------

%%% Folie
{
\small
\setlength{\leftmargini}{1.2em}

\begin{frame}[allowframebreaks]{Fallbeispiel: Hindernisdetektor}
    \begin{columns}[onlytextwidth]
        \column{.49\textwidth}
        \includegraphics[width=\textwidth]{5-hardwarenutzung/img/hindernisdetektor-foto2}

        \column{.49\textwidth}
        \includegraphics[width=\textwidth]{5-hardwarenutzung/img/hindernisdetektor-foto1}
    \end{columns}

    \bigskip
    Erkennung von Hindernissen mit dem KY-032 Hindernisdetektor und der KY-011
    2-Farb LED. Wird ein Hindernis erkannt, leuchtet die LED rot, andernfalls grün.

    \bigskip
    \begin{block}{Hardwareskizze}
        \smallskip
        \includegraphics[width=\textwidth]{5-hardwarenutzung/img/hindernisdetektor-skizze}
    \end{block}

    \framebreak
    \begin{block}{Schaltplan}
        \smallskip
        \includegraphics[width=\textwidth]{5-hardwarenutzung/img/hindernisdetektor-schaltplan}
        {
            \scriptsize
            Pfeile nur zur Verdeutlichung der Stromkreise. Normalerweise besitzt
            ein Schaltplan keine Pfeilenden.
        }
    \end{block}

    \bigskip

    \begin{block}{Hardwareaufbau}
        \smallskip
        \begin{columns}[onlytextwidth]
            \column[T]{.49\textwidth}
            \includegraphics[width=\textwidth]{5-hardwarenutzung/img/breadboard1_bb}

            \column[T]{.49\textwidth}
            \includegraphics[width=\textwidth]{5-hardwarenutzung/img/breadboard2_bb}
        \end{columns}

        \smallskip
        {
            \scriptsize
            Die Linien auf der rechten Seite zeigen, wie die Kontakte des Breadboards
            miteinander verbunden sind.
        }
    \end{block}

    \framebreak
    \begin{columns}
        \column{.65\textwidth}
        \includegraphics[width=\textwidth]{5-hardwarenutzung/img/hindernisdetektor_bb}

        \column{.35\textwidth}
        \begin{block}{Variationen}
            \medskip
            Nutzung anderer Sensoren

            {
                \footnotesize
                \begin{itemize}
                    \item Lichtschranke
                    \item Magnetkontakt
                    \item Berührungssensor
                    \item Schließkontakt
                    \item Neigungsschalter
                    \item \ldots
                \end{itemize}
            }

            \medskip
            Schalten größerer Lasten mit einem Transistor oder Relais

            {
                \footnotesize
                \begin{itemize}
                    \item Warnlampe einschalten
                    \item Durchgangstür öffnen
                    \item Förderband starten
                    \item \ldots
                \end{itemize}
            }
        \end{block}
    \end{columns}
\end{frame}
}

%%% Folie
{
\small
\setlength{\leftmargini}{1.2em}

\begin{frame}{Fallbeispiel: Servomotor}
    \begin{columns}[onlytextwidth]
        \column{.49\textwidth}
        \includegraphics[width=\textwidth]{5-hardwarenutzung/img/servomotor-foto1}

        \column{.49\textwidth}
        \includegraphics[width=\textwidth]{5-hardwarenutzung/img/servomotor-foto2}
    \end{columns}

    \bigskip
    Steuerung eines Servomotors mit Pulsweitenmodulation. Die Länge des Lastzyklus
    bestimmt die Position:

    {
        \footnotesize
        \smallskip
        \begin{itemize}
            \item \textbf{Ganz links:} 1\,ms Puls bei 50\,Hz Frequenz
            \item \textbf{Ganz rechts:} 2\,ms Puls bei 50\,Hz Frequenz
            \item \textbf{Andere:} Jeder Wert dazwischen
        \end{itemize}
    }

    \begin{columns}[onlytextwidth]
        \column[T]{.3\textwidth}
        \begin{block}{Hardwareskizze}
            \smallskip
            \includegraphics[width=\textwidth]{5-hardwarenutzung/img/servomotor-skizze}
        \end{block}

        \column[T]{.59\textwidth}
        \begin{block}{Schaltplan}
            \smallskip
            \includegraphics[width=\textwidth]{5-hardwarenutzung/img/servomotor-schaltplan}
        \end{block}
    \end{columns}
\end{frame}
}

%%% Folie
{
\footnotesize

\begin{frame}{Wiederholung: Pulsweitenmodulation}
    \parbox{\linewidth}{
        Die für eine Arbeit zur Verfügung stehende Stromstärke kann nicht nur durch Widerstände
        absolut reduziert werden. Sie kann durch \textbf{Pulsweitenmodulation} (schnelles Ein-
        und Ausschalten) auch im zeitlichen Mittel reduziert werden. Für kurze Zeit fließt dann
        zwar der volle Strom, die Länge der An- und Ausphasen reduziert jedoch die Gesamtstrommenge
        im zeitlichen Verlauf.
    }

    \begin{center}
        \includegraphics[width=.75\textwidth]{5-hardwarenutzung/img/pwm}
    \end{center}

    \begin{columns}
        \column{.5\textwidth}
        \includegraphics[width=.9\textwidth]{5-hardwarenutzung/img/led_pwm_schaltplan}

        \column{.5\textwidth}
        \includegraphics[width=\textwidth]{5-hardwarenutzung/img/led_pwm_foto}
    \end{columns}
\end{frame}
}

%%% Folie
{
\setlength{\leftmargini}{1.2em}
\footnotesize

\begin{frame}[fragile,allowframebreaks]{Programmierung in Python}
    \begin{block}{Initialisieren und Zurücksetzen der GPIO-Pins}
        \begin{lstlisting}[style=MethodenListe, gobble=12]
            import RPi.GPIO as GPIO
        \end{lstlisting}
        Raspberry Pi GPIO-Modul importieren
        \medskip

        \begin{lstlisting}[style=MethodenListe, gobble=12]
            GPIO.setup(10, GPIO.OUT)
        \end{lstlisting}
        GPIO\,10 als Ausgang konfigurieren
        \medskip

        \begin{lstlisting}[style=MethodenListe, gobble=12]
            GPIO.setup(11, GPIO.IN)
        \end{lstlisting}
        GPIO\,11 als Eingang konfigurieren
        \medskip

        \begin{lstlisting}[style=MethodenListe, gobble=12]
            GPIO.setup(12, GPIO.IN, pull_up_down=GPIO.PUD_DOWN)
        \end{lstlisting}
        GPIO\,12 als Eingang mit internem Pull Down konfigurieren
        \medskip

        \begin{lstlisting}[style=MethodenListe, gobble=12]
            GPIO.setup(13, GPIO.IN, pull_up_down=GPIO.PUD_UP)
        \end{lstlisting}
        GPIO\,13 als Eingang mit internem Pull Up konfigurieren
        \medskip

        \begin{lstlisting}[style=MethodenListe, gobble=12]
            GPIO.cleanup()
        \end{lstlisting}
        Alle GPIO-Pins auf eine sichere Standardkonfiguration zurücksetzen
        \medskip
    \end{block}

    \framebreak

    \begin{block}{Lesen und Schreiben einzelner Pins}
        \begin{lstlisting}[style=MethodenListe, gobble=12]
            value = GPIO.input(14)
        \end{lstlisting}
        Aktuellen Zustands von GPIO\,14 (True oder False) lesen
        \medskip

        \begin{lstlisting}[style=MethodenListe, gobble=12]
            GPIO.output(15, True)
        \end{lstlisting}
        GPIO\,15 auf High bzw. 3,3\,V Spannung setzen
        \medskip

        \begin{lstlisting}[style=MethodenListe, gobble=12]
            GPIO.output(16, False)
        \end{lstlisting}
        GPIO\,16 auf Low bzw. 0\,V Spannung setzen
        \medskip
    \end{block}

    \begin{block}{Reagieren auf Interrupts}
        \begin{lstlisting}[style=MethodenListe, gobble=12]
            GPIO.add_event_detect(17, GPIO.RISING, mein_cb)
        \end{lstlisting}
        Callback-Funktion für steigende Flanken auf GPIO\,17 registrieren
        \medskip

        \begin{lstlisting}[style=MethodenListe, gobble=12]
            GPIO.add_event_detect(18, GPIO.FALLING, mein_cb)
        \end{lstlisting}
        Callback-Funktion für fallende Flanken auf GPIO\,18 registrieren
        \medskip
    \end{block}

    \framebreak

    {
        \begin{lstlisting}[style=MethodenListe, gobble=12]
            GPIO.add_event_detect(19, GPIO.BOTH, mein_cb)
        \end{lstlisting}
        Callback-Funktion für jede Änderung von GPIO\,19 registrieren
        \medskip

        \begin{lstlisting}[style=MethodenListe, gobble=12]
            GPIO.add_event_detect(20, GPIO.BOTH, mein_cb, bouncetime=50)
        \end{lstlisting}
        Callback-Funktion für GPIO\,20 mit einer Entprellung von 50\,ms registrieren
        \medskip
    }

    \begin{block}{Pulsweitenmodulation}
        \begin{lstlisting}[style=MethodenListe, gobble=12]
            pwm = GPIO.PWM(21, 100)
        \end{lstlisting}
        Pulsweitenmodulation von GPIO\,21 vorbereiten
        \medskip

        \begin{lstlisting}[style=MethodenListe, gobble=12]
            pwm.start(50)
        \end{lstlisting}
        Pulsweitenmodulation von GPIO\,21 mit 50\,\% Lastzyklus starten
        \medskip

        \begin{lstlisting}[style=MethodenListe, gobble=12]
            pwm.changeDutyCycle(75)
        \end{lstlisting}
        Lastzyklus der Pulsweitenmodulation von GPIO\,21 auf 75\,\% ändern
        \medskip

        \begin{lstlisting}[style=MethodenListe, gobble=12]
            pwm.stop()
        \end{lstlisting}
        Pulsweitenmodulation von GPIO\,21 stoppen
        \medskip
    \end{block}
\end{frame}
}

%%% Folie
\begin{frame}{Quellcodes}
    Siehe Moodle oder \\
    {
        \small
        \url{https://github.com/DennisSchulmeister/dhbwka-wwi-iottech-quellcodes}
    }

    \smallskip
    \setlength{\fboxsep}{0em}
    \fbox{\includegraphics[width=\textwidth]{5-hardwarenutzung/img/github-servomotor}}
\end{frame}

%-------------------------------------------------------------------------------
\section{Serielle Kommunikation}
%-------------------------------------------------------------------------------

% Folie mit den Einsatzgebieten übernehmen / anpassen
% Folie mit der Übersichtsgrafik übernehmen / anpassen

%%% Folie
\begin{frame}{Folie}
    TODO
\end{frame}

%%% Folie
\begin{frame}{Folie}
    TODO
\end{frame}
